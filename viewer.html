<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <title>Chart Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    #image-wrapper {
      cursor: grab;
      overflow: hidden;
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #chart-image {
      transform-origin: center center;
      transition: transform 0.1s ease;
      user-select: none;
      -webkit-user-drag: none;
      max-width: none;
      max-height: none;
    }

    #image-wrapper:active {
      cursor: grabbing;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">

  <!-- Image Wrapper -->
  <div id="image-wrapper">
    <img id="chart-image" src="" alt="Chart">
  </div>

  <!-- Back & Zoom Controls -->
  <div class="absolute top-4 left-4 flex gap-2 z-10">
    <a href="index.html" class="bg-black bg-opacity-50 hover:bg-opacity-70 text-white px-3 py-1 rounded shadow text-sm">‚Üê Back</a>
  </div>

  <div class="absolute top-4 right-4 flex flex-col gap-2 z-10">
    <button id="zoom-in" class="bg-black bg-opacity-50 hover:bg-opacity-70 text-white px-3 py-1 rounded shadow text-sm">Zoom In</button>
    <button id="zoom-out" class="bg-black bg-opacity-50 hover:bg-opacity-70 text-white px-3 py-1 rounded shadow text-sm">Zoom Out</button>
  </div>

  <!-- Zoom Slider -->
  <div class="fixed bottom-6 left-0 right-0 flex justify-center items-center pointer-events-none z-10">
    <div class="bg-black bg-opacity-40 px-4 py-2 rounded-lg pointer-events-auto">
      <input type="range" id="zoom-slider" min="0.1" max="5" step="0.01" value="1"
             class="w-64 h-2 rounded-lg appearance-none cursor-pointer accent-blue-500">
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const imgPath = urlParams.get('img');
    const image = document.getElementById("chart-image");
    const wrapper = document.getElementById("image-wrapper");
    image.src = imgPath;

    let scale = 1;
    const zoomStep = 0.25;
    const minZoom = 0.1;
    const maxZoom = 5;

    let offsetX = 0;
    let offsetY = 0;
    let isDragging = false;
    let startX = 0;
    let startY = 0;

    function applyTransform() {
      image.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
      document.getElementById("zoom-slider").value = scale.toFixed(2);
    }

    // Zoom Buttons
    document.getElementById("zoom-in").onclick = () => {
      scale = Math.min(scale + zoomStep, maxZoom);
      applyTransform();
    };
    document.getElementById("zoom-out").onclick = () => {
      scale = Math.max(scale - zoomStep, minZoom);
      applyTransform();
    };

    // Zoom Slider
    document.getElementById("zoom-slider").addEventListener("input", (e) => {
      scale = parseFloat(e.target.value);
      applyTransform();
    });

    // Dragging
    wrapper.addEventListener("mousedown", (e) => {
      isDragging = true;
      startX = e.clientX - offsetX;
      startY = e.clientY - offsetY;
      wrapper.style.cursor = "grabbing";
    });

    document.addEventListener("mousemove", (e) => {
      if (!isDragging) return;
      offsetX = e.clientX - startX;
      offsetY = e.clientY - startY;
      applyTransform();
    });

    document.addEventListener("mouseup", () => {
      isDragging = false;
      wrapper.style.cursor = "grab";
    });

    document.addEventListener("mouseleave", () => {
      isDragging = false;
      wrapper.style.cursor = "grab";
    });

    // Keyboard zoom
    document.addEventListener("keydown", (e) => {
      if (e.key === '+' || e.key === '=') {
        scale = Math.min(scale + zoomStep, maxZoom);
        applyTransform();
      } else if (e.key === '-') {
        scale = Math.max(scale - zoomStep, minZoom);
        applyTransform();
      }
    });

    applyTransform();
  </script>
</body>
</html>
